<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Strategic SEO Playbook â€” Learn SEO by Role</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@500&family=Faster+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            font-weight: 500; 
        }
        .font-display { 
            font-family: 'Cruiser', 'Faster One', sans-serif; /* Fallback to Faster One then generic */
        }
        .font-heading {
            font-family: 'Bebas Neue', sans-serif;
            font-weight: normal; 
            letter-spacing: 0.05em;
        }

        .content-section { display: none; }
        .content-section.active { display: block; }
        .question-step { display: none; }
        .question-step.active { display: block; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-content.open { max-height: 1000px;  transition: max-height 0.5s ease-in; }
        .breadcrumb-link { cursor: pointer; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; 
            margin-left: auto;
            margin-right: auto;
            height: 300px; 
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        
        .brand-pink-bg { 
            background-color: #FA4091; 
        }
        .brand-pink-bg:hover { 
            background-color: #F3207E; 
        }
        .brand-text-pink { 
            color: #FA4091; 
        }
        .brand-text-pink:hover { 
            color: #F3207E; 
        }

        .brand-blue-bg { 
            background-color: #4877F8; 
        }
        .brand-blue-bg:hover { 
            background-color: #3A66E4; 
        }
        .brand-text-blue { 
            color: #4877F8; 
        }
        .brand-text-blue:hover { 
            color: #3A66E4; 
        }
        
        .brand-light-blue-bg { 
            background-color: #E0E7FF; 
        }
        .brand-dark-text { 
            color: #1F2937; 
        }
        .brand-secondary-text { 
            color: #4B5563; 
        }

        .brand-button-primary {
            background-color: #FA4091;
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        .brand-button-primary:hover {
            background-color: #F3207E;
        }
        .brand-button-secondary {
            background-color: #4877F8;
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        .brand-button-secondary:hover {
            background-color: #3A66E4;
        }
        .brand-button-reset {
            background-color: #EF4444;
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        .brand-button-reset:hover {
            background-color: #DC2626;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.05em;
        }
        .prose h1, .prose h2, .prose h3, .prose h4 {
            font-family: 'Bebas Neue', sans-serif !important;
            letter-spacing: 0.05em !important;
        }
        .prose {
            color: #374151; 
        }
        .prose strong {
            color: #111827; 
        }
        .execution-steps-list {
            list-style-type: decimal;
            padding-left: 1.5rem;  
        }
        .execution-steps-list li {
            margin-bottom: 0.75rem;  
        }
        .execution-steps-list strong {
            display: block;  
            color: #1F2937;  
            font-family: 'Bebas Neue', sans-serif;  
            font-size: 1.125rem;  
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .execution-steps-list p {
            font-size: 0.95rem;  
            color: #4B5563;  
            margin-left: 0;  
            line-height: 1.6;
        }

    </style>
</head>
<body class="bg-slate-100 brand-dark-text">


    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <h1 class="font-display text-4xl font-bold brand-text-pink">SEO by Role</h1>
                </div>
                <nav class="hidden md:flex space-x-4" id="mainNav">
                    <button data-section="welcomeSection" class="nav-button text-slate-700 hover:brand-text-pink px-3 py-2 rounded-md text-base font-medium">Home</button>
                    <button data-section="corePrinciplesSection" class="nav-button text-slate-700 hover:brand-text-pink px-3 py-2 rounded-md text-base font-medium">Core SEO Principles</button>
                    <button data-section="allRolesSection" class="nav-button text-slate-700 hover:brand-text-pink px-3 py-2 rounded-md text-base font-medium">Browse Roles</button>
                    <button data-section="visionSection" class="nav-button text-slate-700 hover:brand-text-pink px-3 py-2 rounded-md text-base font-medium">Our Vision</button>
                </nav>
                <div class="md:hidden">
                    <button id="mobileMenuButton" class="text-slate-700 hover:brand-text-pink focus:outline-none">
                        <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" focusable="false">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobileMenu" class="md:hidden hidden bg-white shadow-lg py-2">
            <button data-section="welcomeSection" class="block w-full text-left nav-button text-slate-700 hover:brand-text-pink px-4 py-3 text-base">Home</button>
            <button data-section="corePrinciplesSection" class="block w-full text-left nav-button text-slate-700 hover:brand-text-pink px-4 py-3 text-base">Core SEO Principles</button>
            <button data-section="allRolesSection" class="block w-full text-left nav-button text-slate-700 hover:brand-text-pink px-4 py-3 text-base">Browse Roles</button>
            <button data-section="visionSection" class="block w-full text-left nav-button text-slate-700 hover:brand-text-pink px-4 py-3 text-base">Our Vision</button>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8 min-h-screen">
        <div id="breadcrumbContainer" class="mb-6 text-sm text-slate-500">
        </div>

        <section id="welcomeSection" class="content-section active">
            <div class="brand-blue-bg text-white p-10 sm:p-20 rounded-2xl shadow-2xl text-center flex flex-col items-center gap-8">
                <h2 class="font-heading text-5xl sm:text-7xl font-black mb-4 animate__animated animate__fadeInDown">Unlock SEO Success for Every Role</h2>
                <p class="text-xl sm:text-2xl text-blue-100 mb-8 max-w-2xl mx-auto leading-relaxed animate__animated animate__fadeInUp animate__fast">Get personalized, actionable SEO strategies tailored to your role, goals, and industry. Start your journey or jump straight to expert playbooks.</p>
                <div class="flex flex-col sm:flex-row gap-6 justify-center mb-6 animate__animated animate__fadeIn animate__fast">
                    <button id="startQuestionnaireButton" class="brand-button-primary font-heading text-2xl tracking-wider py-5 px-14 rounded-xl shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl focus:outline-none animate__animated animate__fadeInUp animate__fast" aria-label="Start SEO Personalization Questionnaire">
                        Personalize My SEO Strategy
                    </button>
                    <button data-section="allRolesSection" class="brand-button-secondary font-heading text-2xl tracking-wider py-5 px-14 rounded-xl shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl focus:outline-none animate__animated animate__fadeInUp animate__fast" aria-label="Browse SEO Playbooks by Role">
                        Browse SEO Playbooks by Role
                    </button>
                </div>
                <div class="w-full max-w-4xl mx-auto mt-10 animate__animated animate__fadeInUp animate__fast">
                    <h3 class="font-heading text-3xl text-white mb-6">Popular Paths</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <button class="bg-white text-slate-800 rounded-xl p-6 shadow-lg flex flex-col items-start hover:brand-blue-bg hover:text-white transition transition-all duration-300 hover:scale-105 hover:shadow-2xl animate__animated animate__fadeInUp animate__fast" onclick="navigateToSection('contentDisplaySection'); renderContent('Sales.entry.basePlaybook')">
                            <span class="font-heading text-xl mb-2">Sales</span>
                            <span class="text-sm">Boost pipeline & close more deals with SEO.</span>
                        </button>
                        <button class="bg-white text-slate-800 rounded-xl p-6 shadow-lg flex flex-col items-start hover:brand-blue-bg hover:text-white transition transition-all duration-300 hover:scale-105 hover:shadow-2xl animate__animated animate__fadeInUp animate__fast" onclick="navigateToSection('contentDisplaySection'); renderContent('Marketing.entry.basePlaybook')">
                            <span class="font-heading text-xl mb-2">Marketing</span>
                            <span class="text-sm">Drive demand and brand visibility at scale.</span>
                        </button>
                        <button class="bg-white text-slate-800 rounded-xl p-6 shadow-lg flex flex-col items-start hover:brand-blue-bg hover:text-white transition transition-all duration-300 hover:scale-105 hover:shadow-2xl animate__animated animate__fadeInUp animate__fast" onclick="navigateToSection('contentDisplaySection'); renderContent('Product.entry.basePlaybook')">
                            <span class="font-heading text-xl mb-2">Product</span>
                            <span class="text-sm">Grow adoption and launch with SEO best practices.</span>
                        </button>
                        <button class="bg-white text-slate-800 rounded-xl p-6 shadow-lg flex flex-col items-start hover:brand-blue-bg hover:text-white transition transition-all duration-300 hover:scale-105 hover:shadow-2xl animate__animated animate__fadeInUp animate__fast" onclick="navigateToSection('contentDisplaySection'); renderContent('Csuite.entry.basePlaybook')">
                            <span class="font-heading text-xl mb-2">C-Suite</span>
                            <span class="text-sm">Lead your organization with data-driven search strategy.</span>
                        </button>
                    </div>
                </div>
                <div class="w-full max-w-3xl mx-auto mt-16 animate__animated animate__fadeInUp animate__fast">
                    <h3 class="font-heading text-2xl text-white mb-4">How It Works</h3>
                    <div class="flex flex-col sm:flex-row gap-8 justify-center items-center">
                        <div class="flex flex-col items-center">
                            <div class="bg-white text-blue-700 rounded-full w-16 h-16 flex items-center justify-center mb-2 shadow"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg></div>
                            <span class="font-heading text-lg">1. Choose Role or Take Quiz</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="bg-white text-blue-700 rounded-full w-16 h-16 flex items-center justify-center mb-2 shadow"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 00-8 0v4a4 4 0 008 0V7z" />
                            </svg></div>
                            <span class="font-heading text-lg">2. Get Your Playbook</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="bg-white text-blue-700 rounded-full w-16 h-16 flex items-center justify-center mb-2 shadow"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg></div>
                            <span class="font-heading text-lg">3. Apply &amp; Win</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="questionnaireSection" class="content-section">
            <div class="bg-white p-6 sm:p-10 rounded-xl shadow-xl">
                <h2 class="font-heading text-3xl sm:text-4xl font-black brand-text-pink mb-10 text-center">Let's Personalize Your SEO Strategy</h2>
                <div id="questionContainer">
                </div>
                <div class="mt-10 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-6">
                    <button id="prevQuestionButton" class="w-full sm:w-auto bg-slate-300 hover:bg-slate-400 text-slate-800 font-heading tracking-wider py-3 px-8 rounded-lg hidden shadow hover:shadow-md">Previous</button>
                    <button id="resetQuestionnaireButton" class="w-full sm:w-auto brand-button-reset font-heading tracking-wider py-3 px-8 rounded-lg shadow hover:shadow-md">Start Over</button>
                </div>
            </div>
        </section>

        <section id="contentDisplaySection" class="content-section">
            <div id="dynamicContent" class="bg-white p-6 sm:p-10 rounded-xl shadow-xl prose prose-slate max-w-none lg:prose-lg prose-headings:font-heading prose-headings:brand-text-blue prose-h2:text-3xl prose-h2:mb-6 prose-h3:text-2xl prose-h3:mb-4 prose-strong:text-slate-700">
            </div>
        </section>

        <section id="corePrinciplesSection" class="content-section">
            <div class="bg-white p-6 sm:p-10 rounded-xl shadow-xl">
                <h2 class="font-heading text-3xl sm:text-4xl font-black brand-text-pink mb-8 text-center">Core SEO Principles</h2>
                <div id="corePrinciplesContent">
                </div>
            </div>
        </section>

        <section id="allRolesSection" class="content-section">
            <div class="bg-white p-6 sm:p-10 rounded-xl shadow-xl">
                <h2 class="font-heading text-3xl sm:text-4xl font-black brand-text-pink mb-8 text-center">Browse All SEO Playbooks by Role</h2>
                <p class="brand-secondary-text mb-8 text-center text-lg">Explore general SEO strategies tailored for different professional roles and seniority levels. For highly specific strategies, please use the questionnaire.</p>
                <div id="allRolesContent" class="space-y-8">
                </div>
            </div>
        </section>

        <section id="visionSection" class="content-section">
            <div class="bg-white p-6 sm:p-10 rounded-xl shadow-xl">
                <h2 class="font-heading text-3xl sm:text-4xl font-black brand-text-pink mb-8 text-center">Our Vision</h2>
                <div id="visionContent" class="prose prose-slate max-w-none lg:prose-lg prose-headings:font-heading prose-headings:brand-text-blue">
                </div>
            </div>
        </section>

    </main>

    <footer class="brand-dark-text bg-slate-200 py-12 text-center">
        <p class="font-heading tracking-wider">&copy; <span id="currentYear"></span> SEO Playbook. Scale With Search.</p>
        <p class="text-sm text-slate-500 mt-2">Designed to empower your SEO journey.</p>
    </footer>

    <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['DM Sans', 'sans-serif'], 
                heading: ['Bebas Neue', 'sans-serif'], 
                display: ['Cruiser', 'Faster One', 'sans-serif'] 
              },
            }
          }
        }

        // Initialize appData in global scope
        window.appData = window.appData || {};
        
        // Function to initialize the app once data is loaded
        function initializeApp(data) {
            if (!data) {
                console.error('No data provided to initializeApp');
                return;
            }
            
            // Merge the loaded data into the global appData
            window.appData = { ...window.appData, ...data };
            
            // Initialize the application
            if (typeof initApp === 'function') {
                try {
                    initApp();
                } catch (e) {
                    console.error('Error in initApp:', e);
                }
            } else {
                console.error('initApp is not a function');
            }
        }
        
        // Load data when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/appData.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) throw new Error('No data received');
                    initializeApp(data);
                })
                .catch(err => {
                    console.error('Failed to load appData.json:', err);
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = 'color:red;padding:2em;font-size:1.2em;';
                    errorDiv.textContent = 'Error loading application data. Please check the console for details.';
                    document.body.insertBefore(errorDiv, document.body.firstChild);
                });
        });

        function initApp() {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            document.getElementById('startQuestionnaireButton').addEventListener('click', startQuestionnaire);
            document.getElementById('resetQuestionnaireButton').addEventListener('click', resetQuestionnaire);
            document.getElementById('prevQuestionButton').addEventListener('click', goToPreviousQuestion);
            
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const sectionId = button.getAttribute('data-section');
                    navigateToSection(sectionId);
                    const mobileMenu = document.getElementById('mobileMenu');
                    if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            const mobileMenuButton = document.getElementById('mobileMenuButton');
            if(mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    document.getElementById('mobileMenu').classList.toggle('hidden');
                });
            }
            
            loadStaticContent();
            navigateToSection(appData.uiState.activeSection);
            updateBreadcrumbs();
        }

        function loadStaticContent() {
            const corePrinciplesContainer = document.getElementById('corePrinciplesContent');
            if (appData.content.corePrinciples && corePrinciplesContainer) {
                const cpData = appData.content.corePrinciples;
                let cpHtml = '';
                if (cpData.introduction) {
                    cpHtml += `<p class="mb-4 brand-secondary-text">${cpData.introduction}</p>`;
                }
                if (cpData.sections && Array.isArray(cpData.sections)) {
                    cpData.sections.forEach(section => {
                        cpHtml += `<div class="mb-6 p-4 border border-slate-200 rounded-lg bg-slate-50">`;
                        if(section.title) cpHtml += `<h3 class="font-heading text-xl font-black brand-text-pink mb-2">${section.title}</h3>`;
                        if(section.description) cpHtml += `<p class="brand-secondary-text mb-3">${section.description}</p>`;
                        if (section.elements && Array.isArray(section.elements)) {
                            cpHtml += `<ul class="list-disc list-inside brand-secondary-text space-y-1 pl-4">`;
                            section.elements.forEach(element => { cpHtml += `<li>${element}</li>`; });
                            cpHtml += `</ul>`;
                        }
                        cpHtml += `</div>`;
                    });
                }
                if (cpData.conclusion) {
                    cpHtml += `<p class="mt-4 brand-secondary-text">${cpData.conclusion}</p>`;
                }
                corePrinciplesContainer.innerHTML = cpHtml;
            }

            const visionContainer = document.getElementById('visionContent');
             if (appData.content.vision && visionContainer) {
                const visionData = appData.content.vision;
                let visionHtml = '';
                if (visionData.paragraphs && Array.isArray(visionData.paragraphs)) {
                    visionData.paragraphs.forEach(p => { visionHtml += `<p class="mb-4">${p}</p>`; });
                }
                visionContainer.innerHTML = visionHtml;
            }

            const allRolesContainer = document.getElementById('allRolesContent');
            if (allRolesContainer) {
                let allRolesHtml = '';
                Object.keys(appData.content).forEach(deptKey => {
                    if (deptKey !== "corePrinciples" && deptKey !== "vision" && appData.content[deptKey] && appData.content[deptKey].introduction) {
                        const department = appData.content[deptKey];
                        allRolesHtml += `<div class="mb-6 p-6 border border-slate-200 rounded-xl bg-white shadow-lg"><h3 class="font-heading text-2xl font-black brand-text-blue mb-4">${deptKey}</h3><ul class="space-y-2">`;
                        Object.keys(department).forEach(roleKey => {  
                            if (roleKey !== "introduction" && department[roleKey] && department[roleKey].basePlaybook && department[roleKey].basePlaybook.title) {
                                 allRolesHtml += `<li><button class="brand-text-pink brand-text-pink-hover underline font-medium" data-rolepath="${deptKey}.${roleKey}.basePlaybook">${department[roleKey].basePlaybook.title}</button></li>`;
                            }
                        });
                        allRolesHtml += `</ul></div>`;
                    }
                });
                allRolesContainer.innerHTML = allRolesHtml;
                allRolesContainer.querySelectorAll('button[data-rolepath]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const path = e.target.getAttribute('data-rolepath');
                        appData.uiState.selections = {}; 
                        renderContent(path);
                        navigateToSection('contentDisplaySection');
                    });
                });
            }
        }

        function navigateToSection(sectionId, selectionsForBreadcrumb = null) {
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            appData.uiState.activeSection = sectionId;

            let newBreadcrumbs = [{ text: "Home", section: "welcomeSection", selections: {} }];
            const currentSelections = selectionsForBreadcrumb || appData.uiState.selections;

            if (sectionId === "corePrinciplesSection") {
                newBreadcrumbs.push({ text: "Core SEO Principles", section: sectionId, selections: {} });
            } else if (sectionId === "allRolesSection") {
                newBreadcrumbs.push({ text: "Browse All Roles", section: sectionId, selections: {} });
            } else if (sectionId === "visionSection") {
                newBreadcrumbs.push({ text: "Our Vision", section: sectionId, selections: {} });
            } else if (sectionId === "questionnaireSection") {
                 newBreadcrumbs.push({ text: "Questionnaire", section: sectionId, selections: currentSelections });
            } else if (sectionId === "contentDisplaySection") {
                let strategyTitle = "Your Strategy"; 
                if (currentSelections.department) strategyTitle = formatBreadcrumbText(currentSelections.department);
                if (currentSelections.seniority) strategyTitle += ` - ${formatBreadcrumbText(currentSelections.seniority)}`;
                
                newBreadcrumbs.push({ text: strategyTitle, section: sectionId, selections: currentSelections });
            }
            appData.uiState.breadcrumbs = newBreadcrumbs;
            updateBreadcrumbs();
        }
        
        function formatBreadcrumbText(text) {
            if (!text) return '';
            return text.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function updateBreadcrumbs() {
            const container = document.getElementById('breadcrumbContainer');
            if (!container) return;
            container.innerHTML = '';
            appData.uiState.breadcrumbs.forEach((crumb, index) => {
                const el = document.createElement(index === appData.uiState.breadcrumbs.length - 1 ? 'span' : 'button');
                el.textContent = crumb.text;
                el.className = index === appData.uiState.breadcrumbs.length - 1 ? 'brand-dark-text font-semibold' : 'breadcrumb-link brand-text-pink brand-text-pink-hover';
                if (index < appData.uiState.breadcrumbs.length - 1) {
                    el.onclick = () => {
                        appData.uiState.selections = crumb.selections || {}; 
                        if (crumb.section === 'contentDisplaySection' && crumb.contentPath) {
                             renderContent(crumb.contentPath); 
                        }
                        navigateToSection(crumb.section, crumb.selections);
                        if (crumb.section === "questionnaireSection" && appData.uiState.currentQuestionId) {
                            renderQuestion(appData.uiState.currentQuestionId);
                        } else if (crumb.section !== "contentDisplaySection") {
                            const dynamicContentContainer = document.getElementById('dynamicContent');
                            if (dynamicContentContainer) dynamicContentContainer.innerHTML = '';
                        }
                    };
                }
                container.appendChild(el);
                if (index < appData.uiState.breadcrumbs.length - 1) {
                    const separator = document.createElement('span');
                    separator.textContent = ' / ';
                    separator.className = 'mx-1 text-slate-400';
                    container.appendChild(separator);
                }
            });
        }

        function startQuestionnaire() {
            appData.uiState.currentQuestionId = appData.questionnaire.initialQuestionId;
            appData.uiState.selections = {};
            appData.uiState.questionHistory = [];
            navigateToSection('questionnaireSection');
            renderQuestion(appData.uiState.currentQuestionId);
            const prevButton = document.getElementById('prevQuestionButton');
            if(prevButton) prevButton.classList.add('hidden');
        }

        function resetQuestionnaire() {
            appData.uiState.selections = {};
            navigateToSection('welcomeSection');
        }

        function renderQuestion(questionId) {
            const questionObj = appData.questionnaire.questions[questionId];
            const container = document.getElementById('questionContainer');
            if (!questionObj) {
                if(container) container.innerHTML = `<p class="text-red-500">Error: Question "${questionId}" not found.</p>`;
                return;
            }
            if (!container) return;

            let html = `<div class="question-step active p-6 brand-light-blue-bg rounded-lg shadow">
                            <p class="text-lg font-medium text-blue-700 mb-2 font-heading tracking-wide">Step ${appData.uiState.questionHistory.length + 1}: ${questionObj.dimensionName || formatBreadcrumbText(questionObj.options[0]?.dimension || '')}</p>
                            <p class="text-2xl font-semibold brand-dark-text mb-6 font-heading tracking-wide">${questionObj.text}</p>
                            <div class="space-y-3 grid grid-cols-1 sm:grid-cols-2 gap-4">`;
            questionObj.options.forEach((option) => {
                html += `<button data-value="${option.value}" 
                                 data-dimension="${option.dimension}"
                                 data-nextq="${option.nextQuestionId || ''}"
                                 data-isfinal="${option.isFinal || 'false'}"
                                 class="w-full text-left p-4 bg-white hover:bg-pink-50 border-2 border-pink-300 hover:border-pink-500 rounded-lg shadow-sm transition duration-150 ease-in-out focus:ring-2 focus:ring-pink-500 text-slate-700 hover:text-pink-700 font-medium">
                           ${option.text}
                         </button>`;
            });
            html += `</div></div>`;
            container.innerHTML = html;

            container.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', handleAnswer);
            });
            const prevButton = document.getElementById('prevQuestionButton');
            if(prevButton) prevButton.classList.toggle('hidden', appData.uiState.questionHistory.length === 0);
            navigateToSection('questionnaireSection', appData.uiState.selections); 
        }

        function handleAnswer(event) {
            const selectedButton = event.currentTarget;
            const currentQuestionId = appData.uiState.currentQuestionId;
            
            const value = selectedButton.dataset.value;
            const dimension = selectedButton.dataset.dimension;
            const nextQuestionId = selectedButton.dataset.nextq;
            const isFinal = selectedButton.dataset.isfinal === 'true';

            appData.uiState.selections[dimension] = value;
            appData.uiState.questionHistory.push({questionId: currentQuestionId, dimension: dimension, value: value});

            if (isFinal) {
                constructAndRenderFinalContent();
            } else if (nextQuestionId) {
                appData.uiState.currentQuestionId = nextQuestionId;
                renderQuestion(nextQuestionId);
            } else {
                const qContainer = document.getElementById('questionContainer');
                if (qContainer) qContainer.innerHTML = `<p class="text-red-500">Configuration error: No next step defined.</p>`;
            }
        }
        
        function goToPreviousQuestion() {
            if (appData.uiState.questionHistory.length > 0) {
                const lastSelection = appData.uiState.questionHistory.pop();
                delete appData.uiState.selections[lastSelection.dimension]; 
                
                let prevQuestionRenderId = appData.questionnaire.initialQuestionId; 
                if(appData.uiState.questionHistory.length > 0) {
                    prevQuestionRenderId = lastSelection.questionId; 
                } else { 
                     prevQuestionRenderId = appData.questionnaire.initialQuestionId;
                }
                 appData.uiState.currentQuestionId = prevQuestionRenderId;
                renderQuestion(appData.uiState.currentQuestionId);
            }
        }

        function constructAndRenderFinalContent() {
            const selections = appData.uiState.selections;
            let contentPathParts = []; 
            
            const dimensionOrder = ['department', 'seniority', 'goal', 'niche', 'cms']; 
            
            let currentContentLevel = appData.content;
            dimensionOrder.forEach(dim => {
                if (selections[dim]) {
                    if (currentContentLevel && typeof currentContentLevel === 'object' && selections[dim] in currentContentLevel && selections[dim] !== "general" && selections[dim] !== "NotApplicable") {
                        contentPathParts.push(selections[dim]);
                        currentContentLevel = currentContentLevel[selections[dim]];
                    } else if (selections[dim] !== "general" && selections[dim] !== "NotApplicable") {
                        contentPathParts.push(selections[dim]);
                        currentContentLevel = null; 
                    } else {
                        currentContentLevel = null;
                    }
                }
            });
            
            let finalPathString = contentPathParts.join('.');
            let contentObject = getContentObjectByPath(appData.content, finalPathString + ".playbook");

            let tempPathArrayForFallback = [...contentPathParts]; 
            while(!contentObject && tempPathArrayForFallback.length > 0) {
                const basePlaybookPath = tempPathArrayForFallback.join('.') + ".basePlaybook";
                contentObject = getContentObjectByPath(appData.content, basePlaybookPath);
                if (contentObject) {
                    finalPathString = basePlaybookPath;
                    break;
                }
                
                tempPathArrayForFallback.pop(); 
                if(tempPathArrayForFallback.length > 0) {
                     const shorterPlaybookPath = tempPathArrayForFallback.join('.') + ".playbook"; 
                     contentObject = getContentObjectByPath(appData.content, shorterPlaybookPath);
                     if (contentObject) {
                        finalPathString = shorterPlaybookPath;
                        break;
                     }
                } else { 
                    const dept = selections.department;
                    const seniority = selections.seniority;
                    if (dept && seniority) {
                        let path = `${dept}.${seniority}.basePlaybook`;
                        contentObject = getContentObjectByPath(appData.content, path);
                        if(contentObject) finalPathString = path;
                    }
                    if (!contentObject && dept) { 
                        let path = `${dept}.basePlaybook`; 
                        contentObject = getContentObjectByPath(appData.content, path);
                         if(contentObject) finalPathString = path;
                    }
                }
            }
            
            if (contentObject) {
                renderContent(finalPathString); 
                navigateToSection('contentDisplaySection', appData.uiState.selections);
            } else {
                const dynamicContentContainer = document.getElementById('dynamicContent');
                if (dynamicContentContainer) {
                    let selectedPathDisplay = dimensionOrder.map(dim => selections[dim] ? formatBreadcrumbText(selections[dim]) : null).filter(Boolean).join(' > ');
                    dynamicContentContainer.innerHTML = `<div class="p-6 bg-red-50 border-l-4 border-red-500 text-red-700"><p class="font-semibold">Playbook Not Found</p><p>No specific playbook found for the combination: ${selectedPathDisplay}.</p><p class="mt-2">Displaying the most general guidance available for your role, or please try a more general selection in the questionnaire.</p></div>`;
                    
                    let ultimateFallbackPath = selections.department;
                    let ultimateFallbackContent = null;
                    if(ultimateFallbackPath){
                        if(selections.seniority) {
                            let seniorPath = `${ultimateFallbackPath}.${selections.seniority}.basePlaybook`;
                            ultimateFallbackContent = getContentObjectByPath(appData.content, seniorPath);
                            if(ultimateFallbackContent) ultimateFallbackPath = seniorPath;
                        }
                        if(!ultimateFallbackContent && ultimateFallbackPath.includes('.')){ 
                             let deptBasePath = ultimateFallbackPath.split('.')[0] + ".basePlaybook";
                             ultimateFallbackContent = getContentObjectByPath(appData.content, deptBasePath);
                             if(ultimateFallbackContent) ultimateFallbackPath = deptBasePath;
                        } else if (!ultimateFallbackContent && ultimateFallbackPath) { 
                            let deptBasePath = `${ultimateFallbackPath}.basePlaybook`;
                            ultimateFallbackContent = getContentObjectByPath(appData.content, deptBasePath);
                            if(ultimateFallbackContent) ultimateFallbackPath = deptBasePath;
                        }
                    }
                    if(ultimateFallbackContent) { renderContent(ultimateFallbackPath); } else if (dynamicContentContainer.innerHTML.includes('Playbook Not Found')) { /* avoid double message */ }

                }
                navigateToSection('contentDisplaySection', appData.uiState.selections);
            }
        }

        function getContentObjectByPath(obj, pathString) {
            if (!pathString) return null;
            const parts = pathString.split('.');
            let current = obj;
            for (const part of parts) {
                if (current && typeof current === 'object' && part in current) {
                    current = current[part];
                } else {
                    return null; 
                }
            }
            return current;
        }

        function renderContent(contentPathString) {
            const contentObject = getContentObjectByPath(appData.content, contentPathString);
            const container = document.getElementById('dynamicContent');

            if (!container) return;

            if (!contentObject || (!contentObject.title && !contentObject.introduction) ) { 
                if (!container.innerHTML.includes('Playbook Not Found')) {
                    container.innerHTML = `<p class="text-red-500">Content not found for: ${contentPathString.replace(/\./g, ' > ')}.</p>`;
                }
                updateBreadcrumbs(); 
                return;
            }
            
            let html = '';
            if (contentObject.title) {
                html += `<h2 class="font-heading text-4xl font-black brand-text-blue mb-6">${contentObject.title}</h2>`;
            }
            
            const selections = appData.uiState.selections;
            if (Object.keys(selections).length > 0 && contentObject.title) { 
                let selectionSummary = '<div class="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm brand-secondary-text">';
                selectionSummary += '<h4 class="font-heading text-lg font-black text-blue-700 mb-2">Your Personalized Path:</h4><ul class="list-disc list-inside space-y-1">';
                const dimensionDisplayNames = {
                    department: "Department", seniority: "Seniority", 
                    goal: "Goal", tool: "Tool", 
                    process: "Process", niche: "Niche/Industry", cms: "CMS Platform"
                };
                
                const dimensionOrderFromState = ['department', 'seniority', 'goal', 'tool', 'process', 'niche', 'cms']; 
                dimensionOrderFromState.forEach(dim => {
                    if (selections[dim]) {
                        selectionSummary += `<li><strong>${dimensionDisplayNames[dim] || formatBreadcrumbText(dim)}:</strong> ${formatBreadcrumbText(selections[dim])}</li>`;
                    }
                });

                selectionSummary += '</ul></div>';
                html += selectionSummary;
            }
            
            const pathParts = contentPathString.split('.');
            if (selections.department && appData.content[selections.department] && appData.content[selections.department].introduction && pathParts.length > 1 && contentObject.title) { 
                 html += `<p class="italic brand-secondary-text mb-6 border-l-4 border-pink-400 pl-4 py-2 bg-pink-50 rounded-r-md">${appData.content[selections.department].introduction}</p>`;
            } else if (contentObject.introduction && !contentObject.title) { 
                 html += `<p class="brand-secondary-text mb-4">${contentObject.introduction}</p>`;
            }
            
            if (contentObject.focus) {
                 html += `<div class="mb-6 p-6 brand-light-blue-bg rounded-lg shadow">
                            <h3 class="font-heading text-2xl font-black text-blue-700 mb-2">Primary Focus:</h3>
                            <p class="brand-secondary-text text-base">${contentObject.focus}</p>
                          </div>`;
            }

            if (contentObject.actionableTasks && Array.isArray(contentObject.actionableTasks) && contentObject.actionableTasks.length > 0) {
                html += `<h3 class="font-heading text-2xl font-black text-blue-700 mt-8 mb-4">Actionable Tasks:</h3>`;
                contentObject.actionableTasks.forEach((task) => {
                    html += `<div class="mb-4 border border-slate-200 rounded-lg shadow-md">
                                <button class="accordion-toggle w-full text-left p-5 bg-slate-100 hover:bg-slate-200 focus:outline-none flex justify-between items-center rounded-t-lg transition-colors duration-150">
                                    <span class="font-heading text-lg tracking-wider brand-dark-text">${task.title}</span>
                                    <svg class="w-6 h-6 text-slate-500 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content p-5 border-t border-slate-200 bg-white rounded-b-lg">
                                    <p class="brand-secondary-text text-base leading-relaxed">${task.description}</p>
                                </div>
                             </div>`;
                });
            }

            if (contentObject.executionSteps && Array.isArray(contentObject.executionSteps) && contentObject.executionSteps.length > 0) {
                html += `<h3 class="font-heading text-2xl font-black text-blue-700 mt-10 mb-4">Detailed Execution Steps:</h3>
                         <ol class="execution-steps-list space-y-5 brand-secondary-text bg-slate-50 p-6 rounded-lg border border-slate-200 shadow">`; 
                contentObject.executionSteps.forEach(execStep => {
                    html += `<li class="mb-3">
                                <strong>${execStep.step}</strong>
                                <p>${execStep.details}</p>
                             </li>`;
                });
                html += `</ol>`;
            }


            if (contentObject.actionableUnderstanding && Array.isArray(contentObject.actionableUnderstanding) && contentObject.actionableUnderstanding.length > 0) {
                 html += `<h3 class="font-heading text-2xl font-black text-blue-700 mt-10 mb-4">Actionable Understanding:</h3>`;
                 contentObject.actionableUnderstanding.forEach(item => {
                     html += `<div class="mb-4 p-6 bg-slate-50 rounded-lg border border-slate-200 shadow">
                                 <h4 class="font-heading text-xl tracking-wider brand-dark-text">${item.point}</h4>
                                 <p class="brand-secondary-text text-base leading-relaxed">${item.explanation}</p>
                              </div>`;
                 });
            }

            if (contentObject.keyTakeaway) {
                html += `<div class="mt-10 p-8 brand-blue-bg text-white rounded-lg shadow-xl">
                            <h3 class="font-heading text-2xl font-black mb-3">Key Takeaway:</h3>
                            <p class="text-lg leading-relaxed">${contentObject.keyTakeaway}</p>
                         </div>`;
            }

            container.innerHTML = html;
            setupAccordions(); // Still needed for Actionable Tasks
        }

        function setupAccordions() {
            const accordions = document.querySelectorAll('.accordion-toggle');
            accordions.forEach(accordion => {
                accordion.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    const icon = this.querySelector('svg');
                    if (content && icon) { 
                        if (content.classList.contains('open')) {
                            content.classList.remove('open');
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            content.classList.add('open');
                            icon.style.transform = 'rotate(180deg)';
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>
